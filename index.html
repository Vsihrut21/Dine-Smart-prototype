<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale-1.0">
  <title>Dine Smart 1.0</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style id="Color-Control-Panel">
    :root {
      /* --- Primary Theme Color (e.g., Orange) --- */
      --color-primary-50: #fff7ed;
      --color-primary-100: #ddd5ff;
      --color-primary-200: #aab8fe;
      --color-primary-500: #3f1dff; /* Main button color */
      --color-primary-600: #1792fd; /* Main button hover */
      --color-primary-700: #5a11b3; /* Main text color */
      --color-primary-800: #110054; /* Darker text */

      /* --- Secondary Theme Color (e.g., Yellow/Gold) --- */
      --color-secondary-100: #c3e8fe;
      --color-secondary-300: #ae47fd;
      --color-secondary-400: #15faeb;
      --color-secondary-500: #08ccea; /* Added for OTP button */

      /* --- General App Colors --- */
      --color-background-start: #fffbeb; /* Body gradient from */
      --color-background-end: #fef3c7;   /* Body gradient to */
      --color-text-header: #ffffff;      /* Header text (white) */
      --color-success-100: #dcfce7;
      --color-success-500: #22c55e;
      --color-success-800: #15803d;
      --color-danger-100: #fee2e2;
      --color-danger-600: #ef4444;
      --color-danger-800: #b91c1c;
    }
  </style>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-image: linear-gradient(to bottom right, var(--color-background-start), var(--color-background-end));
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fadeIn { animation: fadeIn 0.4s ease-out forwards; }
    @keyframes bump { 0% { transform: scale(1) translateX(-50%); } 50% { transform: scale(1.08) translateX(-50%); } 100% { transform: scale(1) translateX(-50%); } }
    .animate-bump { animation: bump 0.3s ease-out; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    .animate-pulse { animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    @keyframes bounce-slow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
    .animate-bounce-slow { animation: bounce-slow 2s ease-in-out infinite; }
    @keyframes scale-in { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    .animate-scale-in { animation: scale-in 0.4s ease-out forwards; }
    @keyframes scale-in-delay { 0% { transform: scale(0.5); opacity: 0; } 60% { transform: scale(1.05); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
    .animate-scale-in-delay { animation: scale-in-delay 0.6s ease-out 0.2s forwards; opacity: 0; }
    @keyframes pulse-once { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    .animate-pulse-once { animation: pulse-once 0.4s ease-out; }
  </style>
</head>
<body class="bg-gradient-to-br from-[var(--color-background-start)] to-[var(--color-background-end)]">

  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useRef } = React;

    // --- Inline SVG Icons ---
    const Icon = ({ className, children }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        {children}
      </svg>
    );
    const ShoppingCart = ({ className }) => ( <Icon className={className}> <circle cx="9" cy="21" r="1" /><circle cx="20" cy="21" r="1" /> <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" /> </Icon> );
    const Trash2 = ({ className }) => ( <Icon className={className}> <path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /> <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /> <line x1="14" y1="11" x2="14" y2="17" /> </Icon> );
    const Plus = ({ className }) => ( <Icon className={className}><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></Icon> );
    const Minus = ({ className }) => ( <Icon className={className}><line x1="5" y1="12" x2="19" y2="12" /></Icon> );
    const CircleDollarSign = ({ className }) => ( <Icon className={className}> <circle cx="12" cy="12" r="10" /><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8" /> <path d="M12 18V6" /> </Icon> );
    const CheckCircle = ({ className }) => ( <Icon className={className}> <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /> </Icon> );
    const Smartphone = ({ className }) => ( <Icon className={className}> <rect x="5" y="2" width="14" height="20" rx="2" ry="2" /> <line x1="12" y1="18" x2="12.01" y2="18" /> </Icon> );
    const AlertTriangle = ({ className }) => ( <Icon className={className}> <path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /> <line x1="12" y1="9" x2="12" y2="13" /><line x1="12" y1="17" x2="12.01" y2="17" /> </Icon> );
    const ArrowRight = ({ className }) => ( <Icon className={className}> <line x1="5" y1="12" x2="19" y2="12" /><polyline points="12 5 19 12 12 19" /> </Icon> );
    const ChefHat = ({ className }) => ( <Icon className={className}> <path d="M6 13.8V21a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-7.2" /> <path d="M6 13.8A6.4 6.4 0 0 1 12 11a6.4 6.4 0 0 1 6 2.8" /> <path d="M12 11V3a1.9 1.9 0 0 0-2-2 1.9 1.9 0 0 0-2 2v2a1.9 1.9 0 0 0 1.9 2 1.9 1.9 0 0 1 2 1.9z" /> <path d="M12 3a1.9 1.9 0 0 1 2-2 1.9 1.9 0 0 1 2 2v2a1.9 1.9 0 0 1-1.9 2 1.9 1.9 0 0 0-2 1.9z" /> </Icon> );
    const Star = ({ className }) => ( <Icon className={className}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></Icon> );
    const Sparkle = ({ className }) => ( <Icon className={className}><path d="M12 2l2.3 7.4h7.7l-6 4.6 2.3 7.4-6-4.6-6 4.6 2.3-7.4-6-4.6h7.7L12 2z" /></Icon> );
    const Utensils = ({ className }) => ( <Icon className={className}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 002-2V2" /><path d="M7 2v20" /><path d="M21 15V2c0-1.1-.9-2-2-2h-4a2 2 0 00-2 2v13c0 1.1.9 2 2 2h4a2 2 0 002-2z" /></Icon> );
    const GlassOfWine = ({ className }) => ( <Icon className={className}><path d="M8 22h8" /><path d="M12 15v7" /><path d="M12 15a5 5 0 005-5 5 5 0 00-10 0 5 5 0 005 5z" /><path d="M12 15V10" /></Icon> );
    
    // --- NEW --- Icons for Search and Back
    const ArrowLeft = ({ className }) => ( <Icon className={className}><line x1="19" y1="12" x2="5" y2="12" /><polyline points="12 19 5 12 12 5" /></Icon> );
    const Search = ({ className }) => ( <Icon className={className}><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /></Icon> );
    const X = ({ className }) => ( <Icon className={className}><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></Icon> );


    // --- üñºÔ∏è IMAGE & DATA SECTION ---
    const restaurant = {
      name: "Dine Smart 1.0",
      slogan: "By Unitapp!"
    };
    const logoUrl = "dinesmartlogo.png";
    const heroImageUrl = "bg.png"; 
    
    const categoryIcons = {
      appetizers: <Sparkle className="w-8 h-8 mr-3 text-[var(--color-primary-600)]" />,
      mainCourses: <Utensils className="w-8 h-8 mr-3 text-[var(--color-primary-600)]" />,
      drinks: <GlassOfWine className="w-8 h-8 mr-3 text-[var(--color-primary-600)]" />,
    };

    const menuData = {
      specials: [
        { id: 's1', name: 'Panner Tikka Masala', price: 1899, image: 'panner tikka.jpg', description: 'Limited time, fall-off-the-bone ribs!' },
        { id: 's2', name: 'Truffle-infused Pasta', price: 1599, image: 'pasta.jpg', description: 'Our chef\'s signature dish.' },
      ],
      appetizers: [ { id: 'a1', name: 'Spicy Spring Rolls', price: 349, image: 'spingroll.jpg' }, { id: 'a2', name: 'Cheesy Garlic Bread', price: 299, image: 'garlic bread.jpg' }, { id: 'a3', name: 'Tomato Bruschetta', price: 399, image: 'tomato.jpg' }, ],
      mainCourses: [ { id: 'm1', name: 'Fiery Margherita Pizza', price: 599, image: 'pizza.jpeg' }, { id: 'm2', name: 'Smoked BBQ Burger', price: 499, image: 'burgur.jpg' }, { id: 'm3', name: 'Creamy Sun-Dried Tomato Pasta', price: 649, image: 'creamypasta.jpg' }, ],
      drinks: [ { id: 'd1', name: 'Sparkling Orange', price: 149, image: 'orange.jpg' }, { id: 'd2', name: 'Fresh Lemonade', price: 129, image: 'lemon.jpg' }, ],
    };

    // --- Helper Component: Header ---
    // --- MODIFIED --- Added "Back to Menu" button logic
    const Header = ({ cartItemCount, onNavigate, currentPage }) => {
      return (
        <header className="bg-gradient-to-r from-[var(--color-primary-700)] to-[var(--color-primary-500)] shadow-lg sticky top-0 z-50">
          <nav className="container mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-20">
            <div className="flex items-center text-3xl font-extrabold text-[var(--color-text-header)] cursor-pointer" onClick={() => onNavigate('menu')}>
              <img src={logoUrl} alt="Grill Kitchen Logo" className="w-10 h-10 mr-3 rounded-full" />
              Dine Smart 1.0
            </div>
            
            {/* --- NEW --- Conditional logic for Back vs. Cart button */}
            <div className="flex items-center space-x-4">
              {currentPage === 'menu' ? (
                // Show Cart on Menu page
                <button
                  onClick={() => onNavigate('cart')}
                  className="relative text-[var(--color-text-header)] hover:text-[var(--color-secondary-300)] transition-colors duration-300 transform hover:scale-105"
                  aria-label="Open cart"
                >
                  <ShoppingCart className="w-6 h-6" />
                  {cartItemCount > 0 && (
                    <span className="absolute -top-2 -right-2 bg-[var(--color-secondary-400)] text-[var(--color-primary-800)] text-xs w-5 h-5 rounded-full flex items-center justify-center font-bold animate-pulse">
                      {cartItemCount}
                    </span>
                  )}
                </button>
              ) : (
                // Show Back to Menu on all other pages
                <button
                  onClick={() => onNavigate('menu')}
                  className="flex items-center text-[var(--color-text-header)] hover:text-[var(--color-secondary-300)] transition-colors duration-300 transform hover:scale-105 font-medium"
                  aria-label="Back to menu"
                >
                  <ArrowLeft className="w-6 h-6 mr-1" />
                  Menu
                </button>
              )}
            </div>
          </nav>
        </header>
      );
    };

    // --- Helper Component: Menu Item Card ---
    // --- MODIFIED --- Currency change
    const MenuItemCard = ({ item, onAddToCart }) => (
      <div className="bg-white rounded-xl shadow-xl overflow-hidden transition-all duration-300 hover:scale-[1.03] hover:shadow-2xl group relative">
        <img src={item.image} alt={item.name} className="w-full h-36 object-cover transform transition-transform duration-300 group-hover:scale-110" />
        <div className="p-3">
          <h3 className="text-lg font-bold text-gray-800 mb-0.5">{item.name}</h3>
          {item.description && (
            <p className="text-xs text-gray-600 mb-2">{item.description}</p>
          )}
          <p className="text-base font-extrabold text-[var(--color-primary-600)] mb-3">‚Çπ{item.price.toFixed(2)}</p>
          <button onClick={() => onAddToCart(item)} className="w-full bg-[var(--color-primary-600)] text-white font-bold py-1.5 px-4 rounded-lg hover:bg-[var(--color-primary-700)] transition-colors duration-300 transform hover:scale-[1.02]">
            Add to Cart
          </button>
        </div>
      </div>
    );

    // --- Page Component: MenuScreen ---
    // --- MODIFIED --- Added Search state and filtering logic
    const MenuScreen = ({ onAddToCart }) => {
      // --- NEW --- State for the search term
      const [searchTerm, setSearchTerm] = useState('');
      const lowerSearchTerm = searchTerm.toLowerCase();

      // --- NEW --- Filtering logic
      const filteredSpecials = menuData.specials.filter(item =>
        item.name.toLowerCase().includes(lowerSearchTerm)
      );
      
      const filteredOtherCategories = Object.entries(menuData)
        .filter(([category]) => category !== 'specials')
        .map(([category, items]) => {
          const filteredItems = items.filter(item => 
            item.name.toLowerCase().includes(lowerSearchTerm)
          );
          return [category, filteredItems];
        })
        .filter(([category, filteredItems]) => filteredItems.length > 0); // Hide empty categories

      const noResults = filteredSpecials.length === 0 && filteredOtherCategories.length === 0;

      return (
        <div className="container mx-auto p-4 sm:p-6 lg:p-8">
          
          {/* --- Hero Banner --- */}
          <section className="mb-12 bg-gray-800 rounded-xl shadow-2xl overflow-hidden relative" style={{ backgroundImage: `url(${heroImageUrl})`, backgroundSize: 'cover', backgroundPosition: 'center' }}>
            <div className="bg-black bg-opacity-60 p-8 md:p-16 text-center">
              <h1 className="text-4xl md:text-6xl font-extrabold text-white mb-3 animate-fadeIn">
                Welcome to {restaurant.name}
              </h1>
              <p className="text-xl md:text-2xl text-[var(--color-secondary-300)] font-medium animate-fadeIn" style={{ animationDelay: '0.2s' }}>
                {restaurant.slogan}
              </p>
            </div>
          </section>

          {/* --- NEW --- Search Bar */}
          <section className="mb-12">
            <div className="relative">
              <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <Search className="w-5 h-5 text-gray-400" />
              </div>
              <input
                type="search"
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                placeholder="Search for a dish..."
                className="w-full p-4 pl-12 border border-gray-300 rounded-xl shadow-lg focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] text-lg"
              />
              {searchTerm && (
                <button 
                  onClick={() => setSearchTerm('')}
                  className="absolute inset-y-0 right-0 pr-4 flex items-center"
                  aria-label="Clear search"
                >
                  <X className="w-5 h-5 text-gray-500 hover:text-gray-800" />
                </button>
              )}
            </div>
          </section>
          
          {/* --- NEW --- No Results Message */}
          {noResults && (
            <div className="text-center p-10 bg-white rounded-xl shadow-lg">
              <h2 className="text-2xl font-bold text-gray-800 mb-2">No results found</h2>
              <p className="text-gray-600">Try searching for a different dish.</p>
            </div>
          )}

          {/* --- MODIFIED --- Specials Section (now uses filteredSpecials) */}
          {filteredSpecials.length > 0 && (
            <section key="specials" className="mb-12">
              <h2 className="text-4xl font-extrabold text-[var(--color-primary-700)] mb-6 capitalize border-l-8 border-[var(--color-secondary-400)] pl-4 py-2 bg-gradient-to-r from-[var(--color-secondary-100)] to-white rounded-r-full shadow-md flex items-center">
                <Star className="w-8 h-8 mr-3 text-[var(--color-secondary-500)]" />
                Chef's Specials
              </h2>
              <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                {filteredSpecials.map(item => (
                  <MenuItemCard key={item.id} item={item} onAddToCart={onAddToCart} />
                ))}
              </div>
            </section>
          )}

          {/* --- MODIFIED --- Regular Categories (now uses filteredOtherCategories) */}
          {filteredOtherCategories.map(([category, items]) => (
            <section key={category} className="mb-12">
              <h2 className="text-4xl font-extrabold text-gray-800 mb-6 capitalize border-l-8 border-[var(--color-primary-600)] pl-4 py-2 bg-[var(--color-primary-50)] rounded-r-full shadow-md flex items-center">
                {categoryIcons[category] || null}
                {category}
              </h2>
              <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-5">
                {items.map(item => ( <MenuItemCard key={item.id} item={item} onAddToCart={onAddToCart} /> ))}
              </div>
            </section>
          ))}
        </div>
      );
    };

    // --- Page Component: CartScreen ---
    // --- MODIFIED --- Currency change
    const CartScreen = ({ cart, onUpdateQuantity, onRemoveFromCart, onNavigate, total }) => (
      <div className="container mx-auto max-w-3xl p-4 sm:p-6 lg:p-8 my-8">
        <div className="bg-white shadow-2xl rounded-xl overflow-hidden border-t-8 border-[var(--color-primary-600)]">
          <div className="p-6 border-b border-[var(--color-primary-100)] bg-[var(--color-primary-50)]">
            <h2 className="text-3xl font-bold text-center text-[var(--color-primary-800)]">Your Order Summary</h2>
          </div>
          {cart.length === 0 ? ( <p className="text-center text-gray-600 p-10 text-xl font-medium">Your grill is empty!</p> ) : (
            <>
              <div className="p-4 sm:p-6 divide-y divide-[var(--color-primary-100)]">
                {cart.map(item => (
                  <div key={item.id} className="flex flex-col sm:flex-row justify-between items-center py-4 ">
                    <div className="flex items-center mb-4 sm:mb-0">
                      <img src={item.image} alt={item.name} className="w-20 h-20 rounded-lg object-cover mr-4 shadow-md border border-[var(--color-primary-100)]" />
                      <div>
                        <h3 className="text-lg font-semibold text-gray-800">{item.name}</h3>
                        <p className="text-[var(--color-primary-700)] font-bold">‚Çπ{item.price.toFixed(2)}</p>
                      </div>
                    </div>
                    <div className="flex items-center space-x-3">
                      <button onClick={() => onUpdateQuantity(item.id, -1)} className="p-2 rounded-full bg-[var(--color-primary-100)] text-[var(--color-primary-700)] hover:bg-[var(--color-primary-200)] transition-colors transform hover:scale-110" aria-label="Decrease quantity"> <Minus className="w-4 h-4" /> </button>
                      <span className="text-lg font-extrabold w-8 text-center text-gray-900">{item.quantity}</span>
                      <button onClick={() => onUpdateQuantity(item.id, 1)} className="p-2 rounded-full bg-[var(--color-primary-100)] text-[var(--color-primary-700)] hover:bg-[var(--color-primary-200)] transition-colors transform hover:scale-110" aria-label="Increase quantity"> <Plus className="w-4 h-4" /> </button>
                      <button onClick={() => onRemoveFromCart(item.id)} className="p-2 rounded-full text-[var(--color-danger-600)] hover:bg-[var(--color-danger-100)] transition-colors transform hover:scale-110" aria-label="Remove item"> <Trash2 className="w-5 h-5" /> </button>
                    </div>
                  </div>
                ))}
              </div>
              <div className="p-6 bg-[var(--color-primary-50)] border-t border-[var(--color-primary-200)]">
                <div className="flex justify-between items-center mb-6">
                  <span className="text-xl font-semibold text-gray-700">Total:</span>
                  <span className="text-3xl font-extrabold text-[var(--color-primary-800)]">‚Çπ{total.toFixed(2)}</span>
                </div>
                <button onClick={() => onNavigate('otp')} className="w-full bg-[var(--color-primary-600)] text-white font-bold py-3 px-6 rounded-lg text-lg hover:bg-[var(--color-primary-700)] transition-colors duration-300 transform hover:scale-[1.01]">
                  Proceed to Checkout
                </button>
              </div>
            </>
          )}
        </div>
      </div>
    );

    // --- (Paste OTPScreen component here - No Changes) ---
    const OTPScreen = ({ onNavigate }) => {
      const [phone, setPhone] = useState('');
      const [otp, setOtp] = useState('');
      const [sentOtp, setSentOtp] = useState(null);
      const [error, setError] = useState('');
      const handleSendOtp = () => {
        if (phone.length < 10) { setError('Please enter a valid 10-digit phone number.'); return; }
        setError('');
        const generatedOtp = Math.floor(1000 + Math.random() * 9000).toString();
        setSentOtp(generatedOtp);
        console.log(`Generated OTP: ${generatedOtp}`);
      };
      const handleVerify = (e) => {
        e.preventDefault();
        if (otp === sentOtp) { setError(''); onNavigate('payment'); } else { setError('Invalid OTP. Please try again.'); }
      };
      return (
        <div className="flex justify-center items-center min-h-[70vh] p-4">
          <div className="bg-white p-8 rounded-xl shadow-xl w-full max-w-md border-t-8 border-[var(--color-primary-500)] animate-fadeIn">
            <Smartphone className="w-12 h-12 text-[var(--color-primary-600)] mx-auto mb-4 animate-bounce-slow" />
            <h2 className="text-2xl font-bold text-center text-gray-800 mb-2">Secure Your Order</h2>
            <p className="text-center text-gray-600 mb-6">Enter your phone number to receive a verification code.</p>
            {!sentOtp ? (
              <div className="space-y-4">
                <input type="tel" value={phone} onChange={(e) => setPhone(e.target.value)} placeholder="e.g., 98XXXXXX99" className="w-full px-4 py-3 border border-[var(--color-primary-200)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] transition-colors" />
                <button onClick={handleSendOtp} className="w-full bg-[var(--color-primary-600)] text-white font-bold py-3 rounded-lg hover:bg-[var(--color-primary-700)] transition-colors transform hover:scale-[1.01]"> Send OTP </button>
              </div>
            ) : (
              <form onSubmit={handleVerify} className="space-y-4">
                <p className="text-center text-[var(--color-success-800)] font-medium"> OTP sent to {phone}. (Demo OTP: <strong className="text-black">{sentOtp}</strong>) </p>
                <input type="text" value={otp} onChange={(e) => setOtp(e.target.value)} placeholder="Enter 4-digit OTP" maxLength="4" className="w-full px-4 py-3 border border-[var(--color-primary-200)] rounded-lg text-center text-2xl tracking-widest focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] transition-colors" />
                <button type="submit" className="w-full bg-[var(--color-secondary-500)] text-[var(--color-primary-800)] font-bold py-3 rounded-lg hover:bg-[var(--color-secondary-400)] transition-colors transform hover:scale-[1.01]"> Verify & Proceed </button>
              </form>
            )}
            {error && ( <div className="mt-4 flex items-center justify-center text-[var(--color-danger-800)] bg-[var(--color-danger-100)] p-3 rounded-lg animate-pulse-once"> <AlertTriangle className="w-5 h-5 mr-2" /> <span className="text-sm font-medium">{error}</span> </div> )}
          </div>
        </div>
      );
    };
    
    // --- Page Component: PaymentScreen ---
    // --- MODIFIED --- Default tip is 0, currency changed
    const PaymentScreen = ({ onPlaceOrder, total }) => {
      const [tipPercent, setTipPercent] = useState(0); // Default 0 tip
      const [customTip, setCustomTip] = useState("");
      const [isCustom, setIsCustom] = useState(false);

      const tipPercentages = [0, 0.10, 0.15, 0.20]; 

      const handleTipSelect = (percent) => {
        setIsCustom(false);
        setCustomTip("");
        setTipPercent(percent);
      };
      
      const handleCustomClick = () => {
        setIsCustom(true);
        setTipPercent(0);
      };
      
      const handleCustomChange = (e) => {
        const val = e.target.value;
        if (val === "" || /^\d*\.?\d*$/.test(val)) {
          setCustomTip(val);
          setTipPercent(0);
        }
      };

      const tipAmount = isCustom ? (parseFloat(customTip) || 0) : total * tipPercent;
      const grandTotal = total + tipAmount;
      const finalTipAmount = isCustom ? (parseFloat(customTip) || 0) : tipAmount;

      return (
        <div className="flex justify-center items-center min-h-[70vh] p-4">
          <div className="bg-white p-8 rounded-xl shadow-xl w-full max-w-lg border-t-8 border-[var(--color-primary-500)] animate-fadeIn">
            <CircleDollarSign className="w-12 h-12 text-[var(--color-primary-600)] mx-auto mb-4" />
            <h2 className="text-3xl font-bold text-gray-800 mb-4 text-center">Payment</h2>
            
            <div className="bg-[var(--color-primary-50)] p-4 rounded-lg mb-6 border border-[var(--color-primary-100)]">
              <div className="flex justify-between text-lg font-medium text-gray-700">
                <span>Subtotal:</span>
                <span className="font-bold">‚Çπ{total.toFixed(2)}</span>
              </div>
              <hr className="my-2 border-[var(--color-primary-100)]" />
              <div className="text-lg font-medium text-gray-700 mb-3">Add a Tip:</div>
              <div className="flex space-x-2 mb-3">
                {tipPercentages.map(percent => (
                  <button 
                    key={percent}
                    onClick={() => handleTipSelect(percent)}
                    className={`flex-1 py-2 px-3 font-bold rounded-lg transition-colors ${
                      tipPercent === percent && !isCustom 
                      ? 'bg-[var(--color-primary-600)] text-white' 
                      : 'bg-[var(--color-primary-100)] text-[var(--color-primary-700)] hover:bg-[var(--color-primary-200)]'
                    }`}
                  >
                    {percent === 0 ? 'No Tip' : `${percent * 100}%`}
                  </button>
                ))}
                <button 
                  onClick={handleCustomClick}
                  className={`flex-1 py-2 px-3 font-bold rounded-lg transition-colors ${
                    isCustom 
                    ? 'bg-[var(--color-primary-600)] text-white' 
                    : 'bg-[var(--color-primary-100)] text-[var(--color-primary-700)] hover:bg-[var(--color-primary-200)]'
                  }`}
                >
                  Custom
                </button>
              </div>
              
              {isCustom && (
                <div className="relative mb-3">
                  <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">‚Çπ</span>
                  <input
                    type="text"
                    value={customTip}
                    onChange={handleCustomChange}
                    placeholder="Enter amount"
                    className="w-full px-4 py-2 pl-7 border border-[var(--color-primary-200)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] transition-colors"
                  />
                </div>
              )}
              
              <div className="flex justify-between text-lg font-medium text-gray-700">
                <span>Tip:</span>
                <span className="font-bold">‚Çπ{tipAmount.toFixed(2)}</span>
              </div>
              <hr className="my-2 border-dashed border-[var(--color-primary-200)]" />
              <div className="flex justify-between text-2xl font-bold text-[var(--color-primary-800)]">
                <span>Grand Total:</span>
                <span>‚Çπ{grandTotal.toFixed(2)}</span>
              </div>
            </div>
            
            <p className="text-gray-600 mb-8 text-center">How would you like to pay?</p>
            
            <div className="space-y-4">
              <button
                onClick={() => onPlaceOrder('payNow', finalTipAmount, grandTotal)}
                className="w-full bg-gradient-to-r from-[var(--color-primary-500)] to-[var(--color-danger-600)] text-white font-semibold py-4 px-6 rounded-lg text-lg hover:from-[var(--color-primary-600)] hover:to-[var(--color-danger-600)] transition-all duration-300 transform hover:-translate-y-1 shadow-lg"
              >
                Pay Now (Show QR)
              </button>
              <button
                onClick={() => onPlaceOrder('payLater', finalTipAmount, grandTotal)}
                className="w-full bg-gray-700 text-white font-semibold py-4 px-6 rounded-lg text-lg hover:bg-gray-800 transition-colors duration-300 transform hover:-translate-y-1 shadow-lg"
              >
                Pay at the Desk
              </button>
            </div>
          </div>
        </div>
      );
    };

    // --- (Paste ConfirmationScreen component here - No Changes) ---
    const ConfirmationScreen = ({ orderId, paymentMethod, onNavigate }) => (
      <div className="flex justify-center items-center min-h-[70vh] p-4">
        <div className="bg-white p-10 rounded-xl shadow-xl w-full max-w-lg text-center border-t-8 border-[var(--color-success-500)] animate-fadeIn">
          <CheckCircle className="w-16 h-16 text-[var(--color-success-500)] mx-auto mb-6 animate-scale-in" />
          <h2 className="text-3xl font-bold text-gray-800 mb-3">Order Placed Successfully!</h2>
          <p className="text-gray-600 mb-6 text-lg">Your grill order is fired up and being prepared!</p>
          <p className="text-gray-800 mb-4 text-xl font-semibold">
            Order ID: <span className="text-[var(--color-primary-600)] font-bold">{orderId ? orderId.slice(-6) : '...'}</span>
          </p>
          {paymentMethod === 'payNow' && (
            <div className="my-8 flex flex-col items-center bg-[var(--color-secondary-100)] p-6 rounded-lg border border-[var(--color-secondary-300)] shadow-inner">
              <p className="text-gray-700 mb-4 font-medium">Please scan the QR code below.</p>
              <img src="https://placehold.co/250x250/ffffff/303030?text=Simulated+Payment+QR" alt="Payment QR Code" className="rounded-lg shadow-md border-4 border-[var(--color-secondary-400)] animate-scale-in-delay" />
            </div>
          )}
          {paymentMethod === 'payLater' && (
            <div className="my-8 p-6 bg-[var(--color-primary-50)] rounded-lg border border-[var(--color-primary-200)] shadow-inner">
              <p className="text-lg text-[var(--color-primary-800)] font-semibold">
                Please show your Order ID (<span className="text-[var(--color-primary-600)] font-bold">{orderId ? orderId.slice(-6) : '...'}</span>) at the desk.
              </p>
            </div>
          )}
          <button onClick={() => onNavigate('menu')} className="w-full bg-[var(--color-primary-600)] text-white font-bold py-3 px-6 rounded-lg text-lg hover:bg-[var(--color-primary-700)] transition-colors duration-300 transform hover:scale-[1.01]">
            Back to Menu
          </button>
        </div>
      </div>
    );

    // --- Page Component: FloatingCartBar ---
    // --- MODIFIED --- Currency change
    const FloatingCartBar = ({ cartItemCount, total, onNavigate }) => {
      const [isBumping, setIsBumping] = useState(false);
      const mounted = useRef(false);
      useEffect(() => {
        if (mounted.current) {
          if (cartItemCount === 0) return;
          setIsBumping(true);
          const timer = setTimeout(() => setIsBumping(false), 300);
          return () => clearTimeout(timer);
        } else {
          mounted.current = true;
        }
      }, [cartItemCount]);
      return (
        <div className={`fixed bottom-4 left-1/2 -translate-x-1/2 w-[90%] max-w-md z-40 bg-gradient-to-r from-[var(--color-primary-600)] to-[var(--color-danger-600)] text-white rounded-full shadow-2xl p-4 cursor-pointer transition-transform duration-300 ${isBumping ? 'animate-bump' : 'hover:scale-105'}`} onClick={() => onNavigate('cart')}>
          <div className="flex justify-between items-center px-2">
            <div>
              <span className="font-bold text-lg">{cartItemCount} {cartItemCount > 1 ? 'items' : 'item'}</span>
              <span className="mx-2 text-[var(--color-secondary-300)]">|</span>
              <span className="font-bold text-lg">‚Çπ{total.toFixed(2)}</span>
            </div>
            <div className="flex items-center font-semibold text-[var(--color-secondary-300)]"> View Cart <ArrowRight className="w-5 h-5 ml-2" /> </div>
          </div>
        </div>
      );
    };

    // --- Main App Component (Customer Version) ---
    function App() {
      const [currentPage, setCurrentPage] = useState('menu'); 
      const [tableId, setTableId] = useState('N/A'); 
      const [cart, setCart] = useState([]); 
      const [lastOrder, setLastOrder] = useState({ id: null, paymentMethod: null }); 

      useEffect(() => {
        const urlParams = new URLSearchParams(window.location.search);
        const table = urlParams.get('table');
        setTableId(table || 'Walk-In');
      }, []);

      const addToCart = (item) => {
        setCart(prevCart => {
          const existingItem = prevCart.find(i => i.id === item.id);
          if (existingItem) { return prevCart.map(i => i.id === item.id ? { ...i, quantity: i.quantity + 1 } : i ); }
          else { return [...prevCart, { ...item, quantity: 1 }]; }
        });
      };
      const updateQuantity = (itemId, change) => {
        setCart(prevCart => {
          const itemToUpdate = prevCart.find(i => i.id === itemId);
          if (itemToUpdate.quantity + change <= 0) { return prevCart.filter(i => i.id !== itemId); }
          return prevCart.map(i => i.id === itemId ? { ...i, quantity: i.quantity + change } : i );
        });
      };
      const removeFromCart = (itemId) => {
        setCart(prevCart => prevCart.filter(i => i.id !== itemId));
      };
      const cartItemCount = useMemo(() => cart.reduce((acc, item) => acc + item.quantity, 0), [cart]);
      const total = useMemo(() => cart.reduce((acc, item) => acc + item.price * item.quantity, 0), [cart]);

      // --- MODIFIED --- Now accepts tip and grandTotal
      const handlePlaceOrder = (paymentMethod, tip, grandTotal) => {
        const fakeOrderId = `O-${Date.now()}`;
        
        const newOrder = {
          id: fakeOrderId,
          table: tableId,
          items: [...cart],
          subtotal: total,
          tip: tip,
          total: grandTotal,
          status: 'Pending',
          payment: paymentMethod
        };

        console.log("Simulating order placement:", newOrder);
        
        setCart([]);
        setLastOrder({ id: fakeOrderId, paymentMethod: paymentMethod });
        setCurrentPage('confirmation');
      };

      const handleNavigate = (page) => {
        setCurrentPage(page);
      };

      const renderPage = () => {
        switch (currentPage) {
          case 'menu': return <MenuScreen onAddToCart={addToCart} />;
          case 'cart': return <CartScreen cart={cart} onUpdateQuantity={updateQuantity} onRemoveFromCart={removeFromCart} onNavigate={handleNavigate} total={total} />;
          case 'otp': return <OTPScreen onNavigate={handleNavigate} />;
          case 'payment': return <PaymentScreen onPlaceOrder={handlePlaceOrder} total={total} />;
          case 'confirmation': return <ConfirmationScreen orderId={lastOrder.id} paymentMethod={lastOrder.paymentMethod} onNavigate={handleNavigate} />;
          default: return <MenuScreen onAddToCart={addToCart} />;
        }
      };

      return (
        <div className="min-h-screen font-sans">
          {/* --- MODIFIED --- Pass currentPage to Header */}
          <Header cartItemCount={cartItemCount} onNavigate={handleNavigate} currentPage={currentPage} />
          <main key={currentPage} className="animate-fadeIn pb-28"> 
            {tableId && (
              <div className="bg-[var(--color-primary-100)] text-[var(--color-primary-800)] text-center font-semibold p-2 shadow-inner">
                Ordering for Table: S<strong>{tableId}</strong>
              </div>
            )}
            {renderPage()}
          </main>
          {currentPage === 'menu' && cartItemCount > 0 && (
            <FloatingCartBar cartItemCount={cartItemCount} total={total} onNavigate={handleNavigate} />
          )}
        </div>
      );
    }
    
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>

</body>
</html>